<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <style>
      fits-demo {
          display: flex;
          flex-direction: column;
      }
  </style>
</head>
<body>
<script type="module">
    import { html, LitElement } from 'lit';
    import '../src/fits-img.js';
    import '../src/fits-keogram.js';

    export class FITSDemo extends LitElement {
        static properties = {
            _src: { type: String },
            _stretch: { type: String },
            _colormap: { type: String },
            _scaleCutoff: { type: Number },
        };

        constructor() {
            super();
            this._files = {}
            this._stretch = 'linear';
            this._colormap = 'gray';
            this._scaleCutoff = 0.999;
            fetch('/api/2022/03/31/cube.json')
              .then(response => response.json())
              .then(cubes => cubes.filter(cube => !cube.includes('-10')))
              .then(cubes => {
                cubes.forEach(cube => {
                  const station = cube.slice(-16, -15);
                  const wavelength = cube.slice(-14, -10);
                  this._files[wavelength] = this._files[wavelength] || {};
                  this._files[wavelength][station] = this._files[wavelength][station] || [];
                  this._files[wavelength][station].push(cube);
                })
                this.requestUpdate();
            });
        }

        _changeStretch(event) {
            this._stretch = event.target.value;
        }

        _changeColormap(event) {
            this._colormap = event.target.value;
        }

        _changeScaleCutoff(event) {
            this._scaleCutoff = event.target.value;
        }

        images(wavelength, station) {
          if(!this._files) {
            return html``;
          }
          return this._files[wavelength][station.toUpperCase()].map(cube => {
            const name = cube.slice(2);
            return html`<fits-img
              src="files/2022/03/31/${name}"
              ></fits-img>`;
          })
        }

        render() {
            return html`
            <h1>&lt;fits-keogram&gt; interactive demo</h1>
            <p><a href="index.html">Full size image interactive demo</a></p>
            <p>
            <label
              >Stretch
              <select @change="${this._changeStretch}">
                <option>linear</option>
                <option>sqrt</option>
                <option>cuberoot</option>
                <option>log</option>
                <option>sqrtlog</option>
                <option>loglog</option>
              </select></label
            >
            <label
              >Colormap
              <select @change="${this._changeColormap}">
                <option>gray</option>
                <option>heat</option>
                <option>A</option>
                <option>B</option>
              </select></label
            >
            <label
              >Scale cutoff
              <input
                type="number"
                @change="${this._changeScaleCutoff}"
                value="${this._scaleCutoff}"
                step="0.001"
                min="0"
                max="1"
              />
            </label></p>
            <div><fits-keogram stretch=${this._stretch}
                colormap=${this._colormap}
                scale-cutoff="${this._scaleCutoff}">${this.images('5577', 'a')}</fits-keogram></div>
            `;
        }
    }
    customElements.define('fits-demo', FITSDemo);
</script>
<fits-demo></fits-demo>
</body>
</html>
